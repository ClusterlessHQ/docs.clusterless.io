<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Transforms :: Clusterless Docs</title>
    <link rel="canonical" href="https://docs.clusterless.io/tessellate/1.0-wip/reference/transforms.html">
    <meta name="generator" content="Antora 3.1.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
<script defer data-domain="docs.clusterless.io" src="https://plausible.io/js/script.js"></script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.clusterless.io">Clusterless Docs</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Project</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://github.com/ClusterlessHQ/">Repositories</a>
            <a class="navbar-item" href="https://github.com/ClusterlessHQ/clusterless/issues">Issues</a>
            <a class="navbar-item" href="https://github.com/orgs/ClusterlessHQ/discussions">Discussions</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://chris.wensel.net">Support</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="https://github.com/ClusterlessHQ/clusterless/releases">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="tessellate" data-version="1.0-wip">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <button class="nav-menu-toggle" aria-label="Toggle expand/collapse all"></button>
    <h3 class="title"><a href="../index.html">Tessellate</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../install.html">Installation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../support.html">Getting Help</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Reference</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="pipeline.html">Pipeline</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="source-sink.html">Source and Sink</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="transforms.html">Transforms</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="types.html">Types</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Tessellate</span>
    <span class="version">1.0-wip</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../../reference/1.0-wip/index.html">Clusterless Reference</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../reference/1.0-wip/index.html">1.0-wip</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../guide/1.0-wip/index.html">Clusterless User Guide</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../guide/1.0-wip/index.html">1.0-wip</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../index.html">Tessellate</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1.0-wip</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../guide/1.0-wip/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Tessellate</a></li>
    <li>Reference</li>
    <li><a href="transforms.html">Transforms</a></li>
  </ul>
</nav>
<div class="edit-this-page"><a href="https://github.com/ClusterlessHQ/tessellate/edit/wip-1.0/tessellate-main/src/main/antora/modules/reference/pages/transforms.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Transforms</h1>
<div class="sect1">
<h2 id="_fields"><a class="anchor" href="#_fields"></a>Fields</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Input and output files/objects (also referred to as sources and sinks) are made of both rows and columns. Or tuples and fields.</p>
</div>
<div class="paragraph">
<p>A tuple has a set of fields, and a field has an optional <a href="types.html" class="xref page">type</a> (and any associated metadata).</p>
</div>
<div class="paragraph">
<p>Data files, or objects, have paths and names. Field values can be parsed from the paths and embedded in the tuple stream
as fields. This is common when data has been partitioned into files where common values (like month and/or day) can
be embedded in the path name to help select relevant files (push down predicates are applied to path values by many
query engines).</p>
</div>
<div class="paragraph">
<p>Declared fields in a pipeline have the following format: <code>&lt;field_name&gt;|&lt;field_type&gt;</code>, where <code>&lt;field_name&gt;</code> is a string,
or an ordinal (number representing the position).</p>
</div>
<div class="paragraph">
<p><code>&lt;field_type&gt;</code> is optional, depending on the use. <code>&lt;field_type&gt;</code> further may be formatted as <code>&lt;type&gt;|&lt;metadata&gt;</code>.</p>
</div>
<div class="paragraph">
<p>The actual supported types and associated metadata are described in <a href="types.html" class="xref page">Types</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_transforms"><a class="anchor" href="#_transforms"></a>Transforms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Transforms manipulate the tuple stream. They are applied to every tuple in the tuple stream.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Insert literal</dt>
<dd>
<p>Insert a literal value into a field.</p>
</dd>
<dt class="hdlist1">Coerce field</dt>
<dd>
<p>Transform a field, in every tuple.</p>
</dd>
<dt class="hdlist1">Copy field</dt>
<dd>
<p>Copy a field value to a new field.</p>
</dd>
<dt class="hdlist1">Rename field</dt>
<dd>
<p>Rename a field, optionally coercing its type.</p>
</dd>
<dt class="hdlist1">Discard field</dt>
<dd>
<p>Remove a field.</p>
</dd>
<dt class="hdlist1">Apply function</dt>
<dd>
<p>Apply intrinsic functions against one or more fields.</p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="_operators"><a class="anchor" href="#_operators"></a>Operators</h3>
<div class="paragraph">
<p>There are three transform operators:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>=></code></dt>
<dd>
<p>Assign a literal value to a new field.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Format</dt>
<dd>
<p><code>literal => new_field|type</code></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>+&gt;</code></dt>
<dd>
<p>Retain the input field, and assign the result value to a new field.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Format</dt>
<dd>
<p><code>field +&gt; new_field|type</code></p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>-></code></dt>
<dd>
<p>Discard the input fields, and assign the result value to a new field.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Format</dt>
<dd>
<p><code>field -> new_field|type</code></p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>US => country|String</code> - assigns the value <code>US</code> to the field <code>country</code> as a string.</p>
</li>
<li>
<p><code>0.5 => ratio|Double</code> - assigns the value <code>0.5</code> to the field <code>ratio</code> as a double.</p>
</li>
<li>
<p><code>1689820455 => time|DateTime|yyyyMMdd</code> - convert the long value to a date time using the format <code>yyyyMMdd</code> and assign the result to the field <code>time</code>.</p>
</li>
<li>
<p><code>ratio +&gt; ratio|Double</code> - Coerces the string field "ratio" to a double, <code>null</code> ok.</p>
</li>
<li>
<p><code>ratio|Double</code> - Same as above, coerces the string field "ratio" to a double, <code>null</code> ok.</p>
</li>
<li>
<p><code>name +&gt; firstName|String</code> - assigns the value of the field "name" to the field "firstName" as a string. The field <code>name</code> is retained.</p>
</li>
<li>
<p><code>name -> firstName|String</code> - assigns the value of the field "name" to the field "firstName" as a string. The field <code>name</code> is discarded (dropped from the tuple stream).</p>
</li>
<li>
<p><code>password -></code> - discards the field <code>password</code> from the tuple stream.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_expressions"><a class="anchor" href="#_expressions"></a>Expressions</h4>
<div class="paragraph">
<p>Expressions are applied to incoming fields and the results are assigned to a new field. Expressions can have zero or
more field arguments.</p>
</div>
<div class="paragraph">
<p>There are two types of expression:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>functions - combine arguments into new values</p>
</li>
<li>
<p>filters - drop tuples from the tuple stream (currently unimplemented)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Many more expression types are planned, including native support for regular expressions and JSON paths.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Current only <code>intrinsic</code> functions are supported. <code>intrinsic</code> functions are built-in functions, with optional
parameters</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">No arguments</dt>
<dd>
<p><code>^intrinsic{} +&gt; new_field|type</code></p>
</dd>
<dt class="hdlist1">No arguments, with parameters</dt>
<dd>
<p><code>^intrinsic{param1:value1, param2:value2} +&gt; new_field|type</code></p>
</dd>
<dt class="hdlist1">With arguments</dt>
<dd>
<p><code>from_field1+from_field2+from_fieldN ^intrinsic{} +&gt; new_field|type</code></p>
</dd>
<dt class="hdlist1">With arguments, with parameters</dt>
<dd>
<p><code>from_field1+from_field2+from_fieldN ^intrinsic{param1:value1, param2:value2} +&gt; new_field|type</code></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Expression may retain or discard the argument fields depending on the operator used.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_intrinsic_functions"><a class="anchor" href="#_intrinsic_functions"></a>Intrinsic Functions</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Many more functions are planned.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Built-in functions on fields can be applied to one or more fields in every tuple in the tuple stream.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>tsid</code></dt>
<dd>
<p>create a unique id as a long or string (using <a href="https://github.com/f4b6a3/tsid-creator" class="bare">https://github.com/f4b6a3/tsid-creator</a>)</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Def</dt>
<dd>
<p><code>^tsid{node:&#8230;&#8203;,nodeCount:&#8230;&#8203;,epoch:&#8230;&#8203;,format:&#8230;&#8203;,counterToZero:&#8230;&#8203;} +&gt; intoField|type</code></p>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>type</code></dt>
<dd>
<p>must be <code>string</code> or <code>long</code>, defaults to <code>long</code>. When <code>string</code>, the <code>format</code> is honored.</p>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1">Params</dt>
<dd>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>node</code></dt>
<dd>
<p>The node id, defaults to a random int.</p>
<div class="ulist">
<ul>
<li>
<p>If a string is provided, it is hashed to an int.</p>
</li>
<li>
<p><code>SIP_HASHER.hashString(s, StandardCharsets.UTF_8).asInt() % nodeCount;</code></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1"><code>nodeCount</code></dt>
<dd>
<p>The number of nodes, defaults to <code>1024</code></p>
</dd>
<dt class="hdlist1"><code>epoch</code></dt>
<dd>
<p>- The epoch, defaults to <code>Instant.parse("2020-01-01T00:00:00.000Z").toEpochMilli()</code></p>
</dd>
<dt class="hdlist1"><code>format</code></dt>
<dd>
<p>The format, defaults to <code>null</code>. Example: <code>K%S</code> where <code>%S</code> is a placeholder.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Placeholders:</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><code>%S</code>: canonical string in upper case</p>
</li>
<li>
<p><code>%s</code>: canonical string in lower case</p>
</li>
<li>
<p><code>%X</code>: hexadecimal in upper case</p>
</li>
<li>
<p><code>%x</code>: hexadecimal in lower case</p>
</li>
<li>
<p><code>%d</code>: base-10</p>
</li>
<li>
<p><code>%z</code>: base-62</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1"><code>counterToZero</code></dt>
<dd>
<p>Resets the counter portion when the millisecond changes, defaults to <code>false</code>.</p>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</dd>
</dl>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
